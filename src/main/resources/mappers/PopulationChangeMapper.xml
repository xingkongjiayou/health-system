<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="org.csu.healthsystem.util.PopulationChangeDao">

    <!-- ===== 结果映射 ===== -->
    <resultMap id="PopulationNaturalChangeMap"
               type="org.csu.healthsystem.pojo.DO.PopulationChange">
        <id     column="id"                     property="id"/>
        <result column="year"                   property="year"/>
        <result column="births"                 property="births"/>
        <result column="birth_rate"             property="birthRate"/>
        <result column="deaths"                 property="deaths"/>
        <result column="death_rate"             property="deathRate"/>
        <result column="natural_increase"       property="naturalIncrease"/>
        <result column="natural_increase_rate"  property="naturalIncreaseRate"/>
    </resultMap>

    <!-- ===== 通用动态 WHERE ===== -->
    <sql id="dynamicWhere">
        <where>
            <!-- ==== year ==== -->
            <if test="p.yearEq  != null"> AND year =  #{p.yearEq}  </if>
            <if test="p.yearGt  != null"> AND year &gt;  #{p.yearGt} </if>
            <if test="p.yearGte != null"> AND year &gt;= #{p.yearGte}</if>
            <if test="p.yearLt  != null"> AND year &lt;  #{p.yearLt} </if>
            <if test="p.yearLte != null"> AND year &lt;= #{p.yearLte}</if>
            <if test="p.yearNotEq != null"> AND year != #{p.yearNotEq} </if>
            <if test="p.yearIn != null">
                AND year IN
                <foreach collection="p.yearIn" item="item" open="(" separator="," close=")">
                    #{item}
                </foreach>
            </if>

            <if test="p.yearNotIn != null">
                AND year NOT IN
                <foreach collection="p.yearNotIn" item="item" open="(" separator="," close=")">
                    #{item}
                </foreach>
            </if>

            <if test="p.yearLike != null">     AND year LIKE     #{p.yearLike}     </if>
            <if test="p.yearNotLike != null">  AND year NOT LIKE #{p.yearNotLike}  </if>

            <!-- ==== births ==== -->
            <if test="p.birthsEq  != null"> AND births =  #{p.birthsEq}  </if>
            <if test="p.birthsGt  != null"> AND births &gt;  #{p.birthsGt} </if>
            <if test="p.birthsGte != null"> AND births &gt;= #{p.birthsGte}</if>
            <if test="p.birthsLt  != null"> AND births &lt;  #{p.birthsLt} </if>
            <if test="p.birthsLte != null"> AND births &lt;= #{p.birthsLte}</if>
            <if test="p.birthsNotEq != null"> AND births != #{p.birthsNotEq} </if>

            <if test="p.birthsIn != null">
                AND births IN
                <foreach collection="p.birthsIn" item="item" open="(" separator="," close=")">
                    #{item}
                </foreach>
            </if>

            <if test="p.birthsNotIn != null">
                AND births NOT IN
                <foreach collection="p.birthsNotIn" item="item" open="(" separator="," close=")">
                    #{item}
                </foreach>
            </if>

            <if test="p.birthsLike != null">     AND births LIKE     #{p.birthsLike}     </if>
            <if test="p.birthsNotLike != null">  AND births NOT LIKE #{p.birthsNotLike}  </if>
            <!-- ==== birth_rate ==== -->
            <if test="p.birth_rateEq  != null"> AND birth_rate =  #{p.birth_rateEq}  </if>
            <if test="p.birth_rateGt  != null"> AND birth_rate &gt;  #{p.birth_rateGt} </if>
            <if test="p.birth_rateGte != null"> AND birth_rate &gt;= #{p.birth_rateGte}</if>
            <if test="p.birth_rateLt  != null"> AND birth_rate &lt;  #{p.birth_rateLt} </if>
            <if test="p.birth_rateLte != null"> AND birth_rate &lt;= #{p.birth_rateLte}</if>
            <if test="p.birth_rateNotEq != null"> AND birth_rate != #{p.birth_rateNotEq} </if>

            <if test="p.birth_rateIn != null">
                AND birth_rate IN
                <foreach collection="p.birth_rateIn" item="item" open="(" separator="," close=")">
                    #{item}
                </foreach>
            </if>

            <if test="p.birth_rateNotIn != null">
                AND birth_rate NOT IN
                <foreach collection="p.birth_rateNotIn" item="item" open="(" separator="," close=")">
                    #{item}
                </foreach>
            </if>

            <if test="p.birth_rateLike != null">     AND birth_rate LIKE     #{p.birth_rateLike}     </if>
            <if test="p.birth_rateNotLike != null">  AND birth_rate NOT LIKE #{p.birth_rateNotLike}  </if>

            <!-- ==== deaths ==== -->
            <if test="p.deathsEq  != null"> AND deaths =  #{p.deathsEq}  </if>
            <if test="p.deathsGt  != null"> AND deaths &gt;  #{p.deathsGt} </if>
            <if test="p.deathsGte != null"> AND deaths &gt;= #{p.deathsGte}</if>
            <if test="p.deathsLt  != null"> AND deaths &lt;  #{p.deathsLt} </if>
            <if test="p.deathsLte != null"> AND deaths &lt;= #{p.deathsLte}</if>
            <if test="p.deathsNotEq != null"> AND deaths != #{p.deathsNotEq} </if>

            <if test="p.deathsIn != null">
                AND deaths IN
                <foreach collection="p.deathsIn" item="item" open="(" separator="," close=")">
                    #{item}
                </foreach>
            </if>

            <if test="p.deathsNotIn != null">
                AND deaths NOT IN
                <foreach collection="p.deathsNotIn" item="item" open="(" separator="," close=")">
                    #{item}
                </foreach>
            </if>

            <if test="p.deathsLike != null">     AND deaths LIKE     #{p.deathsLike}     </if>
            <if test="p.deathsNotLike != null">  AND deaths NOT LIKE #{p.deathsNotLike}  </if>
            <!-- ==== death_rate ==== -->
            <if test="p.death_rateEq  != null"> AND death_rate =  #{p.death_rateEq}  </if>
            <if test="p.death_rateGt  != null"> AND death_rate &gt;  #{p.death_rateGt} </if>
            <if test="p.death_rateGte != null"> AND death_rate &gt;= #{p.death_rateGte}</if>
            <if test="p.death_rateLt  != null"> AND death_rate &lt;  #{p.death_rateLt} </if>
            <if test="p.death_rateLte != null"> AND death_rate &lt;= #{p.death_rateLte}</if>
            <if test="p.death_rateNotEq != null"> AND death_rate != #{p.death_rateNotEq} </if>

            <if test="p.death_rateIn != null">
                AND death_rate IN
                <foreach collection="p.death_rateIn" item="item" open="(" separator="," close=")">
                    #{item}
                </foreach>
            </if>

            <if test="p.death_rateNotIn != null">
                AND death_rate NOT IN
                <foreach collection="p.death_rateNotIn" item="item" open="(" separator="," close=")">
                    #{item}
                </foreach>
            </if>

            <if test="p.death_rateLike != null">     AND death_rate LIKE     #{p.death_rateLike}     </if>
            <if test="p.death_rateNotLike != null">  AND death_rate NOT LIKE #{p.death_rateNotLike}  </if>
            <!-- ==== natural_increase ==== -->
            <if test="p.natural_increaseEq  != null"> AND natural_increase =  #{p.natural_increaseEq}  </if>
            <if test="p.natural_increaseGt  != null"> AND natural_increase &gt;  #{p.natural_increaseGt} </if>
            <if test="p.natural_increaseGte != null"> AND natural_increase &gt;= #{p.natural_increaseGte}</if>
            <if test="p.natural_increaseLt  != null"> AND natural_increase &lt;  #{p.natural_increaseLt} </if>
            <if test="p.natural_increaseLte != null"> AND natural_increase &lt;= #{p.natural_increaseLte}</if>
            <if test="p.natural_increaseNotEq != null"> AND natural_increase != #{p.natural_increaseNotEq} </if>

            <if test="p.natural_increaseIn != null">
                AND natural_increase IN
                <foreach collection="p.natural_increaseIn" item="item" open="(" separator="," close=")">
                    #{item}
                </foreach>
            </if>

            <if test="p.natural_increaseNotIn != null">
                AND natural_increase NOT IN
                <foreach collection="p.natural_increaseNotIn" item="item" open="(" separator="," close=")">
                    #{item}
                </foreach>
            </if>

            <if test="p.natural_increaseLike != null">     AND natural_increase LIKE     #{p.natural_increaseLike}     </if>
            <if test="p.natural_increaseNotLike != null">  AND natural_increase NOT LIKE #{p.natural_increaseNotLike}  </if>
            <!-- ==== natural_increase_rate ==== -->
            <if test="p.natural_increase_rateEq  != null"> AND natural_increase_rate =  #{p.natural_increase_rateEq}  </if>
            <if test="p.natural_increase_rateGt  != null"> AND natural_increase_rate &gt;  #{p.natural_increase_rateGt} </if>
            <if test="p.natural_increase_rateGte != null"> AND natural_increase_rate &gt;= #{p.natural_increase_rateGte}</if>
            <if test="p.natural_increase_rateLt  != null"> AND natural_increase_rate &lt;  #{p.natural_increase_rateLt} </if>
            <if test="p.natural_increase_rateLte != null"> AND natural_increase_rate &lt;= #{p.natural_increase_rateLte}</if>
            <if test="p.natural_increase_rateNotEq != null"> AND natural_increase_rate != #{p.natural_increase_rateNotEq} </if>

            <if test="p.natural_increase_rateIn != null">
                AND natural_increase_rate IN
                <foreach collection="p.natural_increase_rateIn" item="item" open="(" separator="," close=")">
                    #{item}
                </foreach>
            </if>

            <if test="p.natural_increase_rateNotIn != null">
                AND natural_increase_rate NOT IN
                <foreach collection="p.natural_increase_rateNotIn" item="item" open="(" separator="," close=")">
                    #{item}
                </foreach>
            </if>

            <if test="p.natural_increase_rateLike != null">     AND natural_increase_rate LIKE     #{p.natural_increase_rateLike}     </if>
            <if test="p.natural_increase_rateNotLike != null">  AND natural_increase_rate NOT LIKE #{p.natural_increase_rateNotLike}  </if>
        </where>
    </sql>

    <!-- ===== 动态查询 ===== -->
    <select id="selectByCondition"
            parameterType="map"
            resultMap="PopulationNaturalChangeMap">
        SELECT
         year,
        births, birth_rate,
        deaths, death_rate,
        natural_increase, natural_increase_rate
        FROM population_natural_change
        <include refid="dynamicWhere"/>
        <if test="orderBy != null">
            ORDER BY ${orderBy}
        </if>
        LIMIT #{limit} OFFSET #{offset}
    </select>

    <!-- ===== 统计总数 ===== -->
    <select id="countByCondition"
            parameterType="map"
            resultType="int">
        SELECT COUNT(1)
        FROM population_natural_change
        <include refid="dynamicWhere"/>
    </select>

</mapper>
