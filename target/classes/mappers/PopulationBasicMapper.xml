<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="org.csu.healthsystem.util.PopulationBasicDao">

    <!-- 结果映射 -->
    <resultMap id="PopulationBasicMap" type="org.csu.healthsystem.pojo.DO.PopulationBasic">
        <id     column="id"               property="id"/>
        <result column="year"             property="year"/>
        <result column="total_households" property="totalHouseholds"/>
        <result column="urban_households" property="urbanHouseholds"/>
        <result column="county_households" property="countyHouseholds"/>
        <result column="total_population" property="totalPopulation"/>
        <result column="urban_population" property="urbanPopulation"/>
        <result column="county_population" property="countyPopulation"/>
    </resultMap>

    <sql id="dynamicWhere">
        <where>

            <!-- ===== 年份 ===== -->
            <if test="p.yearEq  != null"> AND year =  #{p.yearEq}  </if>
            <if test="p.yearGt  != null"> AND year &gt;  #{p.yearGt}  </if>
            <if test="p.yearGte != null"> AND year &gt;= #{p.yearGte} </if>
            <if test="p.yearLt  != null"> AND year &lt;  #{p.yearLt}  </if>
            <if test="p.yearLte != null"> AND year &lt;= #{p.yearLte} </if>

            <!-- ===== total_households ===== -->
            <if test="p.total_householdsEq  != null"> AND total_households =  #{p.total_householdsEq}  </if>
            <if test="p.total_householdsGt  != null"> AND total_households &gt;  #{p.total_householdsGt}  </if>
            <if test="p.total_householdsGte != null"> AND total_households &gt;= #{p.total_householdsGte} </if>
            <if test="p.total_householdsLt  != null"> AND total_households &lt;  #{p.total_householdsLt}  </if>
            <if test="p.total_householdsLte != null"> AND total_households &lt;= #{p.total_householdsLte} </if>

            <!-- ===== urban_households ===== -->
            <if test="p.urban_householdsEq  != null"> AND urban_households =  #{p.urban_householdsEq}  </if>
            <if test="p.urban_householdsGt  != null"> AND urban_households &gt;  #{p.urban_householdsGt}  </if>
            <if test="p.urban_householdsGte != null"> AND urban_households &gt;= #{p.urban_householdsGte} </if>
            <if test="p.urban_householdsLt  != null"> AND urban_households &lt;  #{p.urban_householdsLt}  </if>
            <if test="p.urban_householdsLte != null"> AND urban_households &lt;= #{p.urban_householdsLte} </if>

            <!-- ===== county_households ===== -->
            <if test="p.county_householdsEq  != null"> AND county_households =  #{p.county_householdsEq}  </if>
            <if test="p.county_householdsGt  != null"> AND county_households &gt;  #{p.county_householdsGt}  </if>
            <if test="p.county_householdsGte != null"> AND county_households &gt;= #{p.county_householdsGte} </if>
            <if test="p.county_householdsLt  != null"> AND county_households &lt;  #{p.county_householdsLt}  </if>
            <if test="p.county_householdsLte != null"> AND county_households &lt;= #{p.county_householdsLte} </if>

            <!-- ===== total_population ===== -->
            <if test="p.total_populationEq  != null"> AND total_population =  #{p.total_populationEq}  </if>
            <if test="p.total_populationGt  != null"> AND total_population &gt;  #{p.total_populationGt}  </if>
            <if test="p.total_populationGte != null"> AND total_population &gt;= #{p.total_populationGte} </if>
            <if test="p.total_populationLt  != null"> AND total_population &lt;  #{p.total_populationLt}  </if>
            <if test="p.total_populationLte != null"> AND total_population &lt;= #{p.total_populationLte} </if>

            <!-- ===== urban_population ===== -->
            <if test="p.urban_populationEq  != null"> AND urban_population =  #{p.urban_populationEq}  </if>
            <if test="p.urban_populationGt  != null"> AND urban_population &gt;  #{p.urban_populationGt}  </if>
            <if test="p.urban_populationGte != null"> AND urban_population &gt;= #{p.urban_populationGte} </if>
            <if test="p.urban_populationLt  != null"> AND urban_population &lt;  #{p.urban_populationLt}  </if>
            <if test="p.urban_populationLte != null"> AND urban_population &lt;= #{p.urban_populationLte} </if>

            <!-- ===== county_population ===== -->
            <if test="p.county_populationEq  != null"> AND county_population =  #{p.county_populationEq}  </if>
            <if test="p.county_populationGt  != null"> AND county_population &gt;  #{p.county_populationGt}  </if>
            <if test="p.county_populationGte != null"> AND county_population &gt;= #{p.county_populationGte} </if>
            <if test="p.county_populationLt  != null"> AND county_population &lt;  #{p.county_populationLt}  </if>
            <if test="p.county_populationLte != null"> AND county_population &lt;= #{p.county_populationLte} </if>

        </where>
    </sql>
    <!-- ========== 动态查询 ========== -->
    <select id="selectByCondition"
            resultMap="PopulationBasicMap"
            parameterType="map">
        SELECT
        id, year,
        total_households, urban_households, county_households,
        total_population, urban_population, county_population
        FROM population_basic
        <include refid="dynamicWhere"/>
        <if test="orderBy != null">
            ORDER BY ${orderBy}
        </if>
        LIMIT #{limit} OFFSET #{offset}
    </select>

    <!-- ========== 统计总数 ========== -->
    <select id="countByCondition"
            parameterType="map"
            resultType="int">
        SELECT COUNT(1)
        FROM population_basic
        <include refid="dynamicWhere"/>
    </select>

</mapper>
