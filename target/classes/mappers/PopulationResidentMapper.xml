<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="org.csu.healthsystem.util.PopulationResidentDao">

    <!-- 结果映射 -->
    <resultMap id="PopulationResidentMap" type="org.csu.healthsystem.pojo.DO.PopulationResident">
        <result column="year"                property="year"/>
        <result column="resident_population" property="residentPopulation"/>
        <result column="urban_resident"      property="urbanResident"/>
        <result column="rural_resident"      property="ruralResident"/>
        <result column="urbanization_rate"   property="urbanizationRate"/>
    </resultMap>

    <sql id="dynamicWhere">
        <where>

            <!-- ===== year ===== -->
            <if test="p.yearEq  != null"> AND year =  #{p.yearEq}  </if>
            <if test="p.yearGt  != null"> AND year &gt;  #{p.yearGt}  </if>
            <if test="p.yearGte != null"> AND year &gt;= #{p.yearGte} </if>
            <if test="p.yearLt  != null"> AND year &lt;  #{p.yearLt}  </if>
            <if test="p.yearLte != null"> AND year &lt;= #{p.yearLte} </if>

            <!-- ===== resident_population ===== -->
            <if test="p.resident_populationEq  != null"> AND resident_population =  #{p.resident_populationEq}  </if>
            <if test="p.resident_populationGt  != null"> AND resident_population &gt;  #{p.resident_populationGt}  </if>
            <if test="p.resident_populationGte != null"> AND resident_population &gt;= #{p.resident_populationGte} </if>
            <if test="p.resident_populationLt  != null"> AND resident_population &lt;  #{p.resident_populationLt}  </if>
            <if test="p.resident_populationLte != null"> AND resident_population &lt;= #{p.resident_populationLte} </if>

            <!-- ===== urban_resident ===== -->
            <if test="p.urban_residentEq  != null"> AND urban_resident =  #{p.urban_residentEq}  </if>
            <if test="p.urban_residentGt  != null"> AND urban_resident &gt;  #{p.urban_residentGt}  </if>
            <if test="p.urban_residentGte != null"> AND urban_resident &gt;= #{p.urban_residentGte} </if>
            <if test="p.urban_residentLt  != null"> AND urban_resident &lt;  #{p.urban_residentLt}  </if>
            <if test="p.urban_residentLte != null"> AND urban_resident &lt;= #{p.urban_residentLte} </if>

            <!-- ===== rural_resident ===== -->
            <if test="p.rural_residentEq  != null"> AND rural_resident =  #{p.rural_residentEq}  </if>
            <if test="p.rural_residentGt  != null"> AND rural_resident &gt;  #{p.rural_residentGt}  </if>
            <if test="p.rural_residentGte != null"> AND rural_resident &gt;= #{p.rural_residentGte} </if>
            <if test="p.rural_residentLt  != null"> AND rural_resident &lt;  #{p.rural_residentLt}  </if>
            <if test="p.rural_residentLte != null"> AND rural_resident &lt;= #{p.rural_residentLte} </if>

            <!-- ===== urbanization_rate ===== -->
            <if test="p.urbanization_rateEq  != null"> AND urbanization_rate =  #{p.urbanization_rateEq}  </if>
            <if test="p.urbanization_rateGt  != null"> AND urbanization_rate &gt;  #{p.urbanization_rateGt}  </if>
            <if test="p.urbanization_rateGte != null"> AND urbanization_rate &gt;= #{p.urbanization_rateGte} </if>
            <if test="p.urbanization_rateLt  != null"> AND urbanization_rate &lt;  #{p.urbanization_rateLt}  </if>
            <if test="p.urbanization_rateLte != null"> AND urbanization_rate &lt;= #{p.urbanization_rateLte} </if>

        </where>
    </sql>

    <!-- ========== 动态查询 ========== -->
    <select id="selectByCondition"
            resultMap="PopulationResidentMap"
            parameterType="map">
        SELECT
        year,
        resident_population,
        urban_resident,
        rural_resident,
        urbanization_rate
        FROM population_resident
        <include refid="dynamicWhere"/>
        <if test="orderBy != null">
            ORDER BY ${orderBy}
        </if>
        LIMIT #{limit} OFFSET #{offset}
    </select>

    <!-- ========== 统计总数 ========== -->
    <select id="countByCondition"
            parameterType="map"
            resultType="int">
        SELECT COUNT(1)
        FROM population_resident
        <include refid="dynamicWhere"/>
    </select>

</mapper>
